# 第5章　数値積分

## 5.1 数値積分の公式

### 5.1.1 数値積分の公式

関数 $f(x)$ の定積分

$$
I = \int_a^b f(x) \ dx \tag{5.1}
$$

の値は、 $f(x)$ が簡単な場合を除いて、解析的に求めることは困難である。
定積分の近似値を数値的に求める公式を導くことが、この章の目的である。

数値積分の公式は、 $f(x)$ を容易に積分できる関数で近似し、 $(5.1)$ の $f(x)$ の代わりに積分し、

$$
I \cong I_n \equiv h \sum_{i=0}^n w_i f(x_i) \tag{5.2}
$$

の形に求める。
ここに、 $x_i$ は **分点** (point)、 $w_i$ は **重み** (weight) という。
$n + 1$ 個の分点は $x_0 < x_1 < x_2 < x_3 < \cdots < x_{n-1} < x_n$ のように、相異なるものとする。
また、容易に積分できる関数としては、 $x$ の多項式を選ぶのが普通である。

端点が積分の上限と下限に一致するとき、すなわち $x_0 = a$ 、 $x_n = b$ のとき、 $I_n$ は **閉型公式** という。
一致しないとき、すなわち $a < x_0$ 、 $x_n < b$ のとき、 **開型公式** という。

重み $w_i$ は $x_i$ にはよるが、 $f(x)$ にはよらない定数とする。
分点と重みは、誤差

$$
E_n = I - I_n \tag{5.3}
$$

が出来るだけ小さくなるように選ぶ。
誤差 $E_n$ は打切り誤差を以て表す。
$(5.2)$ は $n + 1$ 分点の公式である。
通常、 $n$ が大きいほど $E_n$ の小さな公式が導き出される。

なお、 **数値微分** については、問題 5-12 に簡単にふれておくに止める。

### 5.1.2 台形公式

最も簡単な数値積分の閉型公式は **台形公式** (trapezoidal formula) である。
まず、全閉区間 $[\ a,\ b\ ]$ を $N$ 等分し、分点を等間隔に置く。
すなわち

$$
x_i = a + ih \qquad (0 \leqq i \leqq N ) \qquad \text{ただし} \quad h = \frac{b - a}{N} \tag{5.4}
$$

もちろん、 $x_0 = a$ 、 $x_N = b$ である。
$f(x)$ の近似関数は1次式とする。
2つの分点 $x_i$ と $x_{i+1}$ で $f(x)$ と一致する1次式は

$$
p_1 (x) = \frac{x - x_{i+1}}{x_i - x_{i+1}} f(x_i) + \frac{x - x_i}{x_{i+1} - x_i} f(x_{i+1}) \tag{5.5}
$$

であることは容易に確かめられる。
$p_1(x)$ を一つの区間 $x_i$ から $x_{i+1}$ まで積分すると、一つの台形の面積が次のように得られる：

$$
\begin{aligned}
\int_{x_i}^{x_{i+1}} p_1(x) \ dx & = \int_0^h p_1(y + x_i) \ dy \cr
& = \int_0^h \left[ \frac{y - h}{-h} f(x_i) + \frac{y}{h} f(x_{i+1}) \right] \ dy \cr
& = \frac{h}{2} [f(x_i) + f(x_{i+1})]
\end{aligned}
$$

これより、

$$
\boxed{
\begin{aligned}
\quad \cr
& 台形公式 \cr
& \quad I_1 = \frac{h}{2} [ f(x_i) + f(x_{i+1} ) ] \cr
& \qquad \text{ただし} \quad h = x_{i+1} - x_i \cr
&& \quad \cr
\end{aligned} } \tag{5.6}
$$

台形公式 $(5.6)$ の場合、分点は $x_i$ と $x_{i+1}$ 、重み $w_i$ は

$$
w_0 = w_1 = \frac{1}{2} \tag{5.7}
$$

ととったことになる。

この面積を $x_0 = a$ から $x_N = b$ の $N$ 区間について加えると、

$$
I = \int_a^b f(x) \ dx = \sum_{i=0}^{N-1} \int_{x_i}^{x_{i+1}} f(x) \ dx
$$

であるから、 $(5.6)$ より、

$$
I \cong \frac{h}{2} \sum_{i=0}^{N-1} [\ f(x_i) + f(x_{i+1})\ ]
$$

隣合った各区間の上限と下限は一致するから、

$$
\boxed{
\begin{aligned}
\quad \cr
& \text{台形公式 (複合公式)} \cr
& \quad I_1 = h \left[ \frac{f(a) + f(b)}{2} + \sum_{i=1}^{N-1} f(x_i) \right] & \text{ただし} \quad h = \frac{b - a}{N} \quad
\end{aligned} } \tag{5.8}
$$

が得られる。
この公式が台形の面積の和であるという図上の意味は、図 5.1 より明かである。

### 5.1.3 シンプソンの公式

台形公式に次いで簡単な閉型公式は、シンプソン (Simpson) の公式である。
先ず、積分範囲を $N$ 個の中区間に分割し、各中区間を2等分し、小区間の幅を

$$
h = \frac{b - a}{2N} \tag{5.9}
$$

と置く (図 5.2 参照)。
分点は

$$
x_i = a + ih \qquad (0 \leqq i \leqq 2N ) \tag{5.10}
$$

とする。
各中区間の被積分関数 $f(x)$ を2次式 $p_2(x)$ で近似する。
2次式を完全に (唯一に) 定めるには3分点が必要である。
3分点 $x = x_{2i},\ x_{2i+1},\ x_{2i+2}$ で $p_2(x) = f(x)$ である 2 次式は

$$
\begin{aligned}
p_2(x) = &\ \frac{(x - x_{2i+1})(x - x_{2i+2})}{(x_{2i} - x_{2i+1})(x_{2i} - x_{2i+2})} f(x_{2i}) \cr
& \quad + \frac{(x - x_{2i})(x - x_{2i+2})}{(x_{2i+1} - x_{2i})(x_{2i+1} - x_{2i+2})} f(x_{2i+1}) \cr
& \qquad + \frac{(x - x_{2i})(x - x_{2i+1})}{(x_{2i+2} - x_{2i})(x_{2i+2} - x_{2i+1})} f(x_{2i+2}) \cr
\end{aligned} \tag{5.11}
$$

と書ける。
( 実際、 $p_2(x_{2i}) = f(x_{2i})$ 、 $p_2(x_{2i+1}) = f(x_{2i+1})$ 、 $p_2(x_{2i+2}) = f(x_{2i+2})$ であることを確かめよ。)
分点は $(5.10)$ を満たす等間隔であることを考慮し、 $x = y + x_{2i+1}$ と置くと

$$
p_2(x) = \frac{y(y - h)}{2h^2} f(x_{2i}) + \frac{(y + h)(y - h)}{-h^2} f(x_{2i+1}) + \frac{(y + h) y}{2h^2} f(x_{2i+2}) \tag{5.12}
$$

$(5.12)$ を $x_{2i}$ から $x_{2i+2}$ まで積分すると、

$$
\begin{aligned}
\int_{x_{2i}}^{x_{2i+2}} p_2 (x) \ dx & = \int_{-h}^{h} p_2 (y + x_{2i+1}) \ dy \cr
& = \frac{h}{3} [\ f(x_{2i}) + 4f(x_{2i+1}) + f(x_{2i+2})\ ] \cr
\end{aligned}
$$

故に

$$
\boxed{
\begin{aligned}
\quad & \cr
& \text{シンプソンの公式} \cr
& \quad I_2 = \frac{h}{3} [\ f(x_{2i}) + 4f(x_{2i+1}) + f(x_{2i+2})\ ] \cr
& \quad \qquad ただし \quad h = x_{2i+2} - x_{2i+1} = x_{2i+1} - x_{2i} \cr
& & \quad
\end{aligned}
} \tag{5.13}
$$

すなわち、分点は $x_{2i}$ 、 $x_{2i+1}$ 、 $x_{2i+2}$ 、重みは

$$
w_0 = w_2 = \frac{1}{3}, w_1 = \frac{4}{3} \tag{5.14}
$$

である。

$a$ から $b$ までの $2N$ 小区間の全積分の近似値は、

$$
\int_{a}^{b} p2(x) dx =
\sum_{i=0}^{N-1} 
\int_{x_{2i}}^{x_{2i+2}} p2(y + x_{2i+1}) dy
= h
3
\sum_{i=0}^{N-1} 
[ f(x_{2i}) + 4f(x_{2i+1}) + f(x_{2i+2}) ]
$$

より、各小区間の上限は隣の小区間の下限と一致するから

$$
\boxed{
\begin{aligned}
\quad \cr
& シンプソンの公式 (複合公式) \cr
& \quad I_2 = \frac{h}{3} \left[ f(a) + f(b) + 4\sum_{i=0}^{N-1} f(x_{2i+1}) + 2 \sum_{i=1}^{N-1} f(x_{2i}) \right] \cr
& \quad \qquad \text{ただし} \quad h = \frac{b - a}{2N}, \quad x_i = a + ih \ (0 \leqq i \leqq 2N) \cr
& & \quad
\end{aligned}
} \tag{5.15}
$$

となる。
すなわち、全区間の上限と下限の重みは $1$ 、奇数番目の分点の重みは $4$ 、(上限と下限をのぞく) 偶数番目の分点の重みは $2$ にして、加え合わせればよい。

***

<details><summary></summary><div>

#### 例題 5.1

下限を $a$ 、上限を $b$ 、積分範囲を $H = b - a$ とする。
$a$ から $b$ までの全区間を $N = 2^k$ 個の小区間に分割して、台形公式 (複合公式) を用いたときの積分の近似値を $T^k$ とする。
$k = 0$ からはじめて、 $k = 1, 2, 3, \cdots$ と半分割を進めていき、

$$
\vert T^{k+1} - T^k \vert < \varepsilon \vert T^{k+1} \vert \qquad \varepsilon \text{ は許容相対誤差}
$$

となったとき、 $T^{k+1} を積分の近似値とする。
この手順の PAD を書け。

#### ［解］

$k = 0$ のときは台形公式 $(5.6)$ より

$$
T^0 = H \frac{f(a) + f(b)}{2}
$$

$k = 1$ のときは

$$
\begin{alignedat}{2}
T^1 & = \frac{H}{2} \left[ \frac{f(a) + f(b)}{2} + f \right. && \left. \left( a + \frac{H}{2} \right) \right] \cr
& = \frac{1}{2} T^0 + h f(a + h), && \quad h = \frac{H}{2}
\end{alignedat}
$$

この第1項は既知であるから、第2項のみ新たに計算すればよい。
一般に

$$
T^k = \frac{H}{2^k} \left[ \frac{f(a) + f(b)}{2} + \sum_{i=1}^{2^k-1} f \left( a + i \frac{H}{2^k} \right) \right] \tag{5.16}
$$

である。
これと、 $k$ を $k - 1$ で置き換えた式

$$
T^{k-1} = \frac{H}{2^{k-1}} \left[ \frac{f(a) + f(b)}{2} + \sum_{i=1}^{2^{k-1} - 1} f \left( a + i \frac{H}{2^{k-1}} \right) \right] \tag{5.17}
$$

とを比べると、 $(5.16)$ の総和の $i$ が偶数の項は $(5.17)$ の総和の項に等しいから

$$
T^k = \frac{1}{2} T^{k-1} + h \sum_{i=\text{奇数}}^{2^k -1} f(a + ih) \qquad h = \frac{H}{2^k} \tag{5.18}
$$

の関係がある。
各 $k$ では第2項のみ新たに計算し、前回の値の $1/2$ に加えれば、新しい値が求められる。
この手順を PAD で表すと、図 5.3 となる。

このように、台形公式をはじめとする閉型公式では、 $h$ の半分割を繰り返しながらよい精度の積分近似値を求めるとき、新しい分点での $f(x)$ のみ計算するだけで、旧分点での値を計算し直す必要がない。

***

#### 例題 5.2

前問の台形公式の代わりに、シンプソンの公式 (複合公式) $(5.15)$ を用いたときの PAD を書け。

#### ［解］

シンプソンの公式 (複合公式) $(5.15)$ を検討すると、新規に $f(x)$ の値を計算しなければならない分点の重みは $4$ 、すでに $f(x)$ の値がわかっている分点の重みは $2$ である。
このことを使って PAD を書くと図 5.4 が得られる。

</div></details>

***

### 5.1.4 中点公式

開型公式のもっとも簡単な公式は **中点公式** である。
全区間 $[\ a,\ b\ ]$ を $N$ 個の中区間に分割し、各中区間を2分割して2つの小区間をつく。
各小区間の幅を

$$
h = \frac{b - a}{2N} \tag{5.19}
$$

と置く。
そして各小区間の中点を分点とする (図 5.5 参照)。
すなわち、第 $i$ 中区間の分点は

$$
x_{2i+1} = a + (2i + 1) h \qquad (0 \leqq i \leqq N - 1) \tag{5.20}
$$

第 $i$ 中区間 $[\ x_{2i},\ x_{2i+2}\ ]$ では $f(x)$ は区間の中点での値 $f(x_{2i+1})$ であると近似すると、 $x$ 軸と $f(x)$ とによってつくられるこの区間内の矩形の面積 (積分近似値) は、

$$
\boxed{
\begin{aligned}
\quad \cr
& \text{中点公式} \cr
& \quad I_0 = 2h f(x_{2i+1}) \quad\text{ただし} \quad h = \frac{b - a}{2N} \cr
& & \quad \cr
\end{aligned}
} \tag{5.21}
$$

と得られる。
したがって、全区間 $[\ a,\ b\ ]$ については

$$
\boxed{
\begin{align*}
\quad \cr
& \text{中点公式 (複合公式)} \cr
& \quad I_0 = 2h \sum_{i=0}^{N-1} f(x_{2i+1}) \text{ただし} h = \frac{b - a}{2N} \quad  \tag{5.22} \cr
\end{align*}
}
$$

を積分の近似値とする。

開型公式 (複合公式) の場合は、小区間同士の分点の重なりはない。

## 5.2 補間多項式

### 5.2.1 ラグランジュの補間多項式

前節 5.1 節 で導いた閉型公式 (台形公式、シンプソンの公式) は、被積分関数 $f(x)$ を $x$ の1次式 $p_1(x)$ 、2次式 $p_2(x)$ で近似して、 $f(x)$ の代わりにこれら多項式を積分して導いた。
この節では、任意の関数 $f(x)$ を多項式で近似する方法および近似による誤差をやや一般的に考察しよう。

閉区間 $[\ x_0,\ x_n\ ]$ 内に相異なる分点 $x_0 < x_1 < x_2 < \cdots < x_{n-1} < x_n$ をとる。
これらの $n + 1$ 分点で $f(x)$ と一致する $n$ 次多項式を

$$
p_n (x) = a_0 + a_1 x + a_2 x^2 + \cdots + a_n x^n \tag{5.23}
$$

はただ一通りしかない。
何故なら、分点上で $f(x)$ と $p_n (x)$ は一致するから、

$$
a_0 + a_1 x_i + a_2 x_i^2 + \cdots + a_n x_i^n = f( x_i ) \qquad (0 \leqq i \leqq n) \tag{5.24}
$$

である。
これを $n + 1$ 個の未知数 $a_0,\ a_1,\ \cdots ,\ a_n$ についての連立1次方程式とみなすと、係数の行列式はファンデルモンド (Vandermonde) の行列式 (問題 5-1 参照)

$$
\det \begin{pmatrix}
    1 & x_0 & x_0^2 & \cdots & x_0^n \cr
    1 & x_1 & x_1^2 & \cdots & x_1^n \cr
    1 & x_2 & x_2^2 & \cdots & x_2^n \cr
    \vdots & \vdots & \vdots & \ddots & \vdots \cr
    1 & x_n & x_n^2 & \cdots & x_n^n \cr
\end{pmatrix} = \prod_{i>j} (x_i - x_j) \tag{5.25}
$$

であり、分点はすべて相異なるからこの行列式は $0$ でない。
故に、連立1次方程式の解 $a_0, a_1, \cdots , a_n$ は1組しかなく、多項式 $p_n(x)$ は1つしかない。
解 $a_0, a_1, \cdots , a_n$ を連立1次方程式を解いて求めて $(5.23)$ に代入して $p_n (x)$ を求めてもよいが、 $p_n (x)$ はただ1つしかないから次のようにしてよりスマ－トに求める。
まず、 $(n + 1)$ 次の多項式

$$
\phi_{n+1}(x) = (x - x_0)(x - x_1) \cdots (x - x_n) = \prod_{i=0}^{n} (x - x_i) \tag{5.26}
$$

を導入する。
明らかに

$$
\phi_{n+1}(x_i) = 0 \qquad (0 \leqq i \leqq n) \tag{5.27}
$$

である。
その導関数 $\phi_{n+1}^\prime (x)$ は

$$
\phi_{n+1}^\prime (x) =\sum_{i=0}^{n} \prod_{\substack{k = 0 \cr k \neq i}}^{n} (x - x_k) \tag{5.28}
$$

であり、したがって

$$
\phi_{n+1}^\prime (x_i) = \prod_{\substack{k = 0 \cr k \neq i}}^{n}
( x_i - x_k ) \tag{5.29}
$$

である。
いま

$$
l_i (x) = \frac{\phi_{n+1}(x)}{(x - x_i) \phi_{n+1}^\prime (x_i)} = \prod_{\substack{k = 0 \cr k \neq i}}^{n} \frac{x - x_k}{x_i - x_k} \tag{5.30}
$$

と置くと、 $l_i (x)$ は $x = x_i$ で $1$ 、 $x = x_k \neq x_i$ では $0$ である。
したがって

$$
\boxed{
\begin{alignat*}{1.5}
\quad \cr
& \text{ラグランジュの補間多項式} \cr
& \quad p_n(x) = \sum_{i=0}^{n} l_i (x) f(x_i) & \quad \tag{5.31} \cr
\end{alignat*}
}
$$

と置くと、 $p_n (x)$ は $(5.24)$ を満たす $n$ 次多項式である。
ちなみに、 $n = 1$ のときは $(5.5)$ と一致し、また $n = 2$ のときは $(5.11)$ と一致する。
一般に、 $n + 1$ 個の $x$ で一致する $n$ 次多項式は (表し方はいろいろあるかもしれないが) 1つしか存在しないから、 $(5.31)$ の $p_n (x)$ は $(5.24)$ を満たすその $n$ 次多項式である。
$(5.31)$ の $p_n (x)$ を $n$ 次の **ラグランジュ** (Lagrange) **の補間多項式** という。
