# 第5章　数値積分

## 5.1 数値積分の公式

### 5.1.1 数値積分の公式

関数 $f(x)$ の定積分

$$
I = \int_a^b f(x) \ dx \tag{5.1}
$$

の値は、 $f(x)$ が簡単な場合を除いて、解析的に求めることは困難である。
定積分の近似値を数値的に求める公式を導くことが、この章の目的である。

数値積分の公式は、 $f(x)$ を容易に積分できる関数で近似し、 $(5.1)$ の $f(x)$ の代わりに積分し、

$$
I \cong I_n \equiv h \sum_{i=0}^n w_i f(x_i) \tag{5.2}
$$

の形に求める。
ここに、 $x_i$ は **分点** (point)、 $w_i$ は **重み** (weight) という。
$n + 1$ 個の分点は $x_0 < x_1 < x_2 < x_3 < \cdots < x_{n-1} < x_n$ のように、相異なるものとする。
また、容易に積分できる関数としては、 $x$ の多項式を選ぶのが普通である。

端点が積分の上限と下限に一致するとき、すなわち $x_0 = a$ 、 $x_n = b$ のとき、 $I_n$ は **閉型公式** という。
一致しないとき、すなわち $a < x_0$ 、 $x_n < b$ のとき、 **開型公式** という。

重み $w_i$ は $x_i$ にはよるが、 $f(x)$ にはよらない定数とする。
分点と重みは、誤差

$$
E_n = I - I_n \tag{5.3}
$$

が出来るだけ小さくなるように選ぶ。
誤差 $E_n$ は打切り誤差を以て表す。
$(5.2)$ は $n + 1$ 分点の公式である。
通常、 $n$ が大きいほど $E_n$ の小さな公式が導き出される。

なお、 **数値微分** については、問題 5-12 に簡単にふれておくに止める。

### 5.1.2 台形公式

最も簡単な数値積分の閉型公式は **台形公式** (trapezoidal formula) である。
まず、全閉区間 $[\ a,\ b\ ]$ を $N$ 等分し、分点を等間隔に置く。
すなわち

$$
x_i = a + ih \qquad (0 \leqq i \leqq N ) \qquad \text{ただし} \quad h = \frac{b - a}{N} \tag{5.4}
$$

もちろん、 $x_0 = a$ 、 $x_N = b$ である。
$f(x)$ の近似関数は1次式とする。
2つの分点 $x_i$ と $x_{i+1}$ で $f(x)$ と一致する1次式は

$$
p_1 (x) = \frac{x - x_{i+1}}{x_i - x_{i+1}} f(x_i) + \frac{x - x_i}{x_{i+1} - x_i} f(x_{i+1}) \tag{5.5}
$$

であることは容易に確かめられる。
$p_1(x)$ を一つの区間 $x_i$ から $x_{i+1}$ まで積分すると、一つの台形の面積が次のように得られる：

$$
\begin{aligned}
\int_{x_i}^{x_{i+1}} p_1(x) \ dx & = \int_0^h p_1(y + x_i) \ dy \cr
& = \int_0^h \left[ \frac{y - h}{-h} f(x_i) + \frac{y}{h} f(x_{i+1}) \right] \ dy \cr
& = \frac{h}{2} [f(x_i) + f(x_{i+1})]
\end{aligned}
$$

これより、

$$
\boxed{
\begin{aligned}
\quad \cr
& 台形公式 \cr
& \quad I_1 = \frac{h}{2} [ f(x_i) + f(x_{i+1} ) ] \cr
& \qquad \text{ただし} \quad h = x_{i+1} - x_i \cr
&& \quad \cr
\end{aligned} } \tag{5.6}
$$

台形公式 $(5.6)$ の場合、分点は $x_i$ と $x_{i+1}$ 、重み $w_i$ は

$$
w_0 = w_1 = \frac{1}{2} \tag{5.7}
$$

ととったことになる。

この面積を $x_0 = a$ から $x_N = b$ の $N$ 区間について加えると、

$$
I = \int_a^b f(x) \ dx = \sum_{i=0}^{N-1} \int_{x_i}^{x_{i+1}} f(x) \ dx
$$

であるから、 $(5.6)$ より、

$$
I \cong \frac{h}{2} \sum_{i=0}^{N-1} [\ f(x_i) + f(x_{i+1})\ ]
$$

隣合った各区間の上限と下限は一致するから、

$$
\boxed{
\begin{aligned}
\quad \cr
& \text{台形公式 (複合公式)} \cr
& \quad I_1 = h \left[ \frac{f(a) + f(b)}{2} + \sum_{i=1}^{N-1} f(x_i) \right] & \text{ただし} \quad h = \frac{b - a}{N} \quad
\end{aligned} } \tag{5.8}
$$

が得られる。
この公式が台形の面積の和であるという図上の意味は、図 5.1 より明かである。

### 5.1.3 シンプソンの公式

台形公式に次いで簡単な閉型公式は、シンプソン (Simpson) の公式である。
先ず、積分範囲を $N$ 個の中区間に分割し、各中区間を2等分し、小区間の幅を

$$
h = \frac{b - a}{2N} \tag{5.9}
$$

と置く (図 5.2 参照)。
分点は

$$
x_i = a + ih \qquad (0 \leqq i \leqq 2N ) \tag{5.10}
$$

とする。
各中区間の被積分関数 $f(x)$ を2次式 $p_2(x)$ で近似する。
2次式を完全に (唯一に) 定めるには3分点が必要である。
3分点 $x = x_{2i},\ x_{2i+1},\ x_{2i+2}$ で $p_2(x) = f(x)$ である 2 次式は

$$
\begin{aligned}
p_2(x) = &\ \frac{(x - x_{2i+1})(x - x_{2i+2})}{(x_{2i} - x_{2i+1})(x_{2i} - x_{2i+2})} f(x_{2i}) \cr
& \quad + \frac{(x - x_{2i})(x - x_{2i+2})}{(x_{2i+1} - x_{2i})(x_{2i+1} - x_{2i+2})} f(x_{2i+1}) \cr
& \qquad + \frac{(x - x_{2i})(x - x_{2i+1})}{(x_{2i+2} - x_{2i})(x_{2i+2} - x_{2i+1})} f(x_{2i+2}) \cr
\end{aligned} \tag{5.11}
$$

と書ける。
( 実際、 $p_2(x_{2i}) = f(x_{2i})$ 、 $p_2(x_{2i+1}) = f(x_{2i+1})$ 、 $p_2(x_{2i+2}) = f(x_{2i+2})$ であることを確かめよ。)
分点は $(5.10)$ を満たす等間隔であることを考慮し、 $x = y + x_{2i+1}$ と置くと

$$
p_2(x) = \frac{y(y - h)}{2h^2} f(x_{2i}) + \frac{(y + h)(y - h)}{-h^2} f(x_{2i+1}) + \frac{(y + h) y}{2h^2} f(x_{2i+2}) \tag{5.12}
$$

$(5.12)$ を $x_{2i}$ から $x_{2i+2}$ まで積分すると、

$$
\begin{aligned}
\int_{x_{2i}}^{x_{2i+2}} p_2 (x) \ dx & = \int_{-h}^{h} p_2 (y + x_{2i+1}) \ dy \cr
& = \frac{h}{3} [\ f(x_{2i}) + 4f(x_{2i+1}) + f(x_{2i+2})\ ] \cr
\end{aligned}
$$

故に

$$
\boxed{
\begin{aligned}
\quad & \cr
& \text{シンプソンの公式} \cr
& \quad I_2 = \frac{h}{3} [\ f(x_{2i}) + 4f(x_{2i+1}) + f(x_{2i+2})\ ] \cr
& \quad \qquad ただし \quad h = x_{2i+2} - x_{2i+1} = x_{2i+1} - x_{2i} \cr
& & \quad
\end{aligned}
} \tag{5.13}
$$

すなわち、分点は $x_{2i}$ 、 $x_{2i+1}$ 、 $x_{2i+2}$ 、重みは

$$
w_0 = w_2 = \frac{1}{3}, w_1 = \frac{4}{3} \tag{5.14}
$$

である。

$a$ から $b$ までの $2N$ 小区間の全積分の近似値は、

$$
\begin{aligned}
\int_{a}^{b} p_2 (x) dx & = \sum_{i=0}^{N-1} \int_{x_{2i}}^{x_{2i+2}} p_2 (y + x_{2i+1}) \ dy \cr
& = \frac{h}{3} \sum_{i=0}^{N-1} [ f(x_{2i}) + 4f(x_{2i+1}) + f(x_{2i+2}) ] \cr
\end{aligned}
$$

より、各小区間の上限は隣の小区間の下限と一致するから

$$
\boxed{
\begin{aligned}
\quad \cr
& シンプソンの公式 (複合公式) \cr
& \quad I_2 = \frac{h}{3} \left[ f(a) + f(b) + 4\sum_{i=0}^{N-1} f(x_{2i+1}) + 2 \sum_{i=1}^{N-1} f(x_{2i}) \right] \cr
& \quad \qquad \text{ただし} \quad h = \frac{b - a}{2N}, \quad x_i = a + ih \ (0 \leqq i \leqq 2N) \cr
& & \quad
\end{aligned}
} \tag{5.15}
$$

となる。
すなわち、全区間の上限と下限の重みは $1$ 、奇数番目の分点の重みは $4$ 、(上限と下限をのぞく) 偶数番目の分点の重みは $2$ にして、加え合わせればよい。

***

<details><summary></summary><div>

#### 例題 5.1

下限を $a$ 、上限を $b$ 、積分範囲を $H = b - a$ とする。
$a$ から $b$ までの全区間を $N = 2^k$ 個の小区間に分割して、台形公式 (複合公式) を用いたときの積分の近似値を $T^k$ とする。
$k = 0$ からはじめて、 $k = 1, 2, 3, \cdots$ と半分割を進めていき、

$$
\vert T^{k+1} - T^k \vert < \varepsilon \vert T^{k+1} \vert \qquad \varepsilon \text{ は許容相対誤差}
$$

となったとき、 $T^{k+1} を積分の近似値とする。
この手順の PAD を書け。

#### ［解］

$k = 0$ のときは台形公式 $(5.6)$ より

$$
T^0 = H \frac{f(a) + f(b)}{2}
$$

$k = 1$ のときは

$$
\begin{alignedat}{2}
T^1 & = \frac{H}{2} \left[ \frac{f(a) + f(b)}{2} + f \right. && \left. \left( a + \frac{H}{2} \right) \right] \cr
& = \frac{1}{2} T^0 + h f(a + h), && \quad h = \frac{H}{2}
\end{alignedat}
$$

この第1項は既知であるから、第2項のみ新たに計算すればよい。
一般に

$$
T^k = \frac{H}{2^k} \left[ \frac{f(a) + f(b)}{2} + \sum_{i=1}^{2^k-1} f \left( a + i \frac{H}{2^k} \right) \right] \tag{5.16}
$$

である。
これと、 $k$ を $k - 1$ で置き換えた式

$$
T^{k-1} = \frac{H}{2^{k-1}} \left[ \frac{f(a) + f(b)}{2} + \sum_{i=1}^{2^{k-1} - 1} f \left( a + i \frac{H}{2^{k-1}} \right) \right] \tag{5.17}
$$

とを比べると、 $(5.16)$ の総和の $i$ が偶数の項は $(5.17)$ の総和の項に等しいから

$$
T^k = \frac{1}{2} T^{k-1} + h \sum_{i=\text{奇数}}^{2^k -1} f(a + ih) \qquad h = \frac{H}{2^k} \tag{5.18}
$$

の関係がある。
各 $k$ では第2項のみ新たに計算し、前回の値の $1/2$ に加えれば、新しい値が求められる。
この手順を PAD で表すと、図 5.3 となる。

このように、台形公式をはじめとする閉型公式では、 $h$ の半分割を繰り返しながらよい精度の積分近似値を求めるとき、新しい分点での $f(x)$ のみ計算するだけで、旧分点での値を計算し直す必要がない。

***

#### 例題 5.2

前問の台形公式の代わりに、シンプソンの公式 (複合公式) $(5.15)$ を用いたときの PAD を書け。

#### ［解］{#solve5.2}

シンプソンの公式 (複合公式) $(5.15)$ を検討すると、新規に $f(x)$ の値を計算しなければならない分点の重みは $4$ 、すでに $f(x)$ の値がわかっている分点の重みは $2$ である。
このことを使って PAD を書くと図 5.4 が得られる。

</div></details>

***

### 5.1.4 中点公式

開型公式のもっとも簡単な公式は **中点公式** である。
全区間 $[\ a,\ b\ ]$ を $N$ 個の中区間に分割し、各中区間を2分割して2つの小区間をつく。
各小区間の幅を

$$
h = \frac{b - a}{2N} \tag{5.19}
$$

と置く。
そして各小区間の中点を分点とする (図 5.5 参照)。
すなわち、第 $i$ 中区間の分点は

$$
x_{2i+1} = a + (2i + 1) h \qquad (0 \leqq i \leqq N - 1) \tag{5.20}
$$

第 $i$ 中区間 $[\ x_{2i},\ x_{2i+2}\ ]$ では $f(x)$ は区間の中点での値 $f(x_{2i+1})$ であると近似すると、 $x$ 軸と $f(x)$ とによってつくられるこの区間内の矩形の面積 (積分近似値) は、

$$
\boxed{
\begin{aligned}
\quad \cr
& \text{中点公式} \cr
& \quad I_0 = 2h f(x_{2i+1}) \quad\text{ただし} \quad h = \frac{b - a}{2N} \cr
& & \quad \cr
\end{aligned}
} \tag{5.21}
$$

と得られる。
したがって、全区間 $[\ a,\ b\ ]$ については

$$
\boxed{
\begin{align*}
\quad \cr
& \text{中点公式 (複合公式)} \cr
& \quad I_0 = 2h \sum_{i=0}^{N-1} f(x_{2i+1}) \text{ただし} h = \frac{b - a}{2N} \quad  \tag{5.22} \cr
\end{align*}
}
$$

を積分の近似値とする。

開型公式 (複合公式) の場合は、小区間同士の分点の重なりはない。

## 5.2 補間多項式

### 5.2.1 ラグランジュの補間多項式

前節 5.1 節 で導いた閉型公式 (台形公式、シンプソンの公式) は、被積分関数 $f(x)$ を $x$ の1次式 $p_1(x)$ 、2次式 $p_2(x)$ で近似して、 $f(x)$ の代わりにこれら多項式を積分して導いた。
この節では、任意の関数 $f(x)$ を多項式で近似する方法および近似による誤差をやや一般的に考察しよう。

閉区間 $[\ x_0,\ x_n\ ]$ 内に相異なる分点 $x_0 < x_1 < x_2 < \cdots < x_{n-1} < x_n$ をとる。
これらの $n + 1$ 分点で $f(x)$ と一致する $n$ 次多項式を

$$
p_n (x) = a_0 + a_1 x + a_2 x^2 + \cdots + a_n x^n \tag{5.23}
$$

はただ一通りしかない。
何故なら、分点上で $f(x)$ と $p_n (x)$ は一致するから、

$$
a_0 + a_1 x_i + a_2 x_i^2 + \cdots + a_n x_i^n = f( x_i ) \qquad (0 \leqq i \leqq n) \tag{5.24}
$$

である。
これを $n + 1$ 個の未知数 $a_0,\ a_1,\ \cdots ,\ a_n$ についての連立1次方程式とみなすと、係数の行列式はファンデルモンド (Vandermonde) の行列式 (問題 5-1 参照)

$$
\det \begin{pmatrix}
    1 & x_0 & x_0^2 & \cdots & x_0^n \cr
    1 & x_1 & x_1^2 & \cdots & x_1^n \cr
    1 & x_2 & x_2^2 & \cdots & x_2^n \cr
    \vdots & \vdots & \vdots & \ddots & \vdots \cr
    1 & x_n & x_n^2 & \cdots & x_n^n \cr
\end{pmatrix} = \prod_{i>j} (x_i - x_j) \tag{5.25}
$$

であり、分点はすべて相異なるからこの行列式は $0$ でない。
故に、連立1次方程式の解 $a_0, a_1, \cdots , a_n$ は1組しかなく、多項式 $p_n(x)$ は1つしかない。
解 $a_0, a_1, \cdots , a_n$ を連立1次方程式を解いて求めて $(5.23)$ に代入して $p_n (x)$ を求めてもよいが、 $p_n (x)$ はただ1つしかないから次のようにしてよりスマ－トに求める。
まず、 $(n + 1)$ 次の多項式

$$
\phi_{n+1}(x) = (x - x_0)(x - x_1) \cdots (x - x_n) = \prod_{i=0}^{n} (x - x_i) \tag{5.26}
$$

を導入する。
明らかに

$$
\phi_{n+1}(x_i) = 0 \qquad (0 \leqq i \leqq n) \tag{5.27}
$$

である。
その導関数 $\phi_{n+1}^\prime (x)$ は

$$
\phi_{n+1}^\prime (x) =\sum_{i=0}^{n} \prod_{\substack{k = 0 \cr k \neq i}}^{n} (x - x_k) \tag{5.28}
$$

であり、したがって

$$
\phi_{n+1}^\prime (x_i) = \prod_{\substack{k = 0 \cr k \neq i}}^{n}
( x_i - x_k ) \tag{5.29}
$$

である。
いま

$$
l_i (x) = \frac{\phi_{n+1}(x)}{(x - x_i) \phi_{n+1}^\prime (x_i)} = \prod_{\substack{k = 0 \cr k \neq i}}^{n} \frac{x - x_k}{x_i - x_k} \tag{5.30}
$$

と置くと、 $l_i (x)$ は $x = x_i$ で $1$ 、 $x = x_k \neq x_i$ では $0$ である。
したがって

$$
\boxed{
\begin{alignat*}{1.5}
\quad \cr
& \text{ラグランジュの補間多項式} \cr
& \quad p_n(x) = \sum_{i=0}^{n} l_i (x) f(x_i) & \quad \tag{5.31} \cr
\end{alignat*}
}
$$

と置くと、 $p_n (x)$ は $(5.24)$ を満たす $n$ 次多項式である。
ちなみに、 $n = 1$ のときは $(5.5)$ と一致し、また $n = 2$ のときは $(5.11)$ と一致する。
一般に、 $n + 1$ 個の $x$ で一致する $n$ 次多項式は (表し方はいろいろあるかもしれないが) 1つしか存在しないから、 $(5.31)$ の $p_n (x)$ は $(5.24)$ を満たすその $n$ 次多項式である。
$(5.31)$ の $p_n (x)$ を $n$ 次の **ラグランジュ** (Lagrange) **の補間多項式** という。

### 5.2.2 差分商

ラグランジュの補間多項式は $(5.31)$ にしたがって求められる。
そのほかに $p_0 (x) = f(x_0)$ より始まって、 $p_1 (x)$ 、 $p_2 (x)$ 、 $\cdots$ と次つぎに導く **漸化式** <sup>[$1)$](#note1)</sup> (recurrence formula) がある。
この漸化式を導く準備として、次のような **差分商** (divided difference) の列を考えよう。

> <small id="note1">$^{1)}$ ゼンカシキと読む。</small>

$$
\begin{align*}
& f[x_0] = f(x_0) \tag{5.32} \cr
& f[x_1, x_0] = \frac{f[x_1] - f[x_0]}{x_1 - x_0} = \frac{f(x_0)}{x_0 - x_1} + \frac{f(x_1)}{x_1 - x_0} = f[x_0, x_1] \qquad \qquad \qquad \tag{5.33} \cr
& f[x_2, x_1, x_0] = \frac{f[x_2, x_1] - f[x_1, x_0]}{x_2 - x_0} \cr
\end{align*}
$$

$$
= \frac{f(x_0)}{(x_0 - x_1)(x_0 - x_2)} + \frac{f(x_1)}{(x_1 - x_0)(x_1 - x_2)} + \frac{f(x_2)}{(x_2 - x_0)(x_2 - x_1)}
$$

$$
= f[x_2, x_0, x_1] = f[x_1, x_2, x_0] = f[x_1, x_0, x_2] = \cdots = f[x_0, x_1, x_2] \tag{5.34}
$$

一般に

$$
\begin{align*}
& f[x_n, x_{n-1}, \cdots , x_1, x_0] \cr
& \quad = \frac{f[x_n, x_{n-1}, \cdots , x_1] - f[x_{n-1}, \cdots , x_1, x_0]}{x_n - x_0} \cr
& \quad = \sum_{i=0}^{n} \frac{f(x_i)}{(x_i - x_0) \cdots (x_i - x_{i-1})(x_i - x_{i+1}) \cdots (x_i - x_n)} \cr
& \quad = \sum_{i=0}^{n} \frac{f(x_i)}{\phi_{n+1}^\prime (x_i)} \tag{5.35} \cr
\end{align*}
$$

差分商 $f[x_n, x_{n-1}, \cdots x_1, x_0]$ は変数 $x_0, x_1, x_2, x_3, \cdots , x_n$ の順番を変えても変わらない。
すなわち、差分商はその変数について対称式である。
このことは $(5.32)$ 、 $(5.33)$ 、 $(5.34)$ 、 $(5.35)$ から明かである。

> #### ［例 5.1］
>
> 差分商の性質を理解するために、簡単な $f(x)$ について差分商を見てみよう。
>
> $$
> \begin{aligned}
> f(x) = &\ x \text{のとき} \cr \cr
> & f[x_0] = f(x_0) = x_0 \cr
> & f[x_1, x_0] = \frac{f[x_1] - f[x_0]}{x_1 - x_0} = \frac{x_1 - x_0}{x_1 - x_0} = 1 \cr \cr
> f(x) = &\ x_2 \text{のとき} \cr \cr
> & f[x_0] = f(x_0) = x_0^2 \cr
> & f[x_1, x_0] = \frac{f[x_1] - f[x_0]}{x_1 - x_0} = \frac{x_{1}^{2} - x_{0}^{2}}{x_1 - x_0} = x_1 + x_0 \cr
> & f[x_2, x_1, x_0] = \frac{f[x_2, x_1] - f[x_1, x_0]}{x_2 - x_0} = \frac{x_2 - x_0}{x_2 - x_0} = 1 \cr \cr
> f(x) = &\ x_3 \text{のとき} \cr \cr
> & f[x_0] = x_{0}^{3} \cr
> & f[x_1, x_0] = \frac{f[x_1] - f[x_0]}{x_1 - x_0} = \frac{x_{1}^{3} - x_{0}^{3}}{x_1 - x_0} = x_{1}^{2} + x_1 x_0 + x_{0}^{2} \cr
> & f[x_2, x_1, x_0] = \frac{f[x_2, x_1] - f[x_1, x_0]}{x_2 - x} = x_2 + x_1 + x_0 \cr
> & f[x_3, x_2, x_1, x_0] = 1 \cr
> \end{aligned}
> $$
>
> 差分商は、その変数について対称式である。
> たとえば、 $f(x) = x_3$ のとき、
>
> $$
> \begin{aligned}
> & f[x_0, x_1] = f[x_1, x_0] = x_{1}^{2} + x_1 x_0 + x_{0}^{2} \cr
> & f[x_0, x_1, x_2] = f[x_0, x_2, x_1] = \cdots = f[x_2, x_1, x_0] = x_2 + x_1 + x_0 \cr
> & f[x_0, x_1, x_2, x_3] = f[x_0, x_1, x_3, x_2] = \cdots = f[x_3, x_2, x_1, x_0] = 1 \cr
> \end{aligned}
> $$
>
> であり、 $x_0$ 、 $x_1$ 、 $x_2$ 、 $x_3$ の交換に対して不変である。

### 5.2.3 前進差分

特に $x_0, x_1, x_2, \cdots, x_n$ が等間隔であるときは、

$$
x_i = x_0 + ih \qquad (0 \leqq i \leqq n)
$$

である。
このとき、

$$
\varDelta f(x) \equiv f(x + h) - f(x) \tag{5.36}
$$

を **前進差分** (forward difference) という。
前進差分の前進差分は

$$
\begin{aligned}
\varDelta (\varDelta f (x)) & = \varDelta (f(x + h) - f(x)) \cr
& = \varDelta f(x + h) - \varDelta f(x) \cr
\end{aligned}
$$

である。
これを $\varDelta^2 f(x)$ と書き **第2階前進差分** と呼ぶ。
くわしく書くと、

$$
\begin{aligned}
\varDelta^2 f(x) & = (f(x + 2h) - f(x + h)) - (f(x + h) - f(x)) \cr
& = f(x + 2h) - 2f(x + h) + f(x) \cr
\end{aligned}
$$

である。
これらの前進差分は差分商によって

$$
\begin{alignedat}{2}
& \varDelta f(x_0) & & = f(x_1) - f(x_0) = h f[x_1, x_0] \cr
& \varDelta^2 f(x_0) & & = \varDelta f(x_1) - \varDelta f(x_0) \cr
& & & = h f[x_2, x_1] - h f[x_1, x_0] = 2 h^2 f[x_2, x_1, x_0] \cr
\end{alignedat}
$$

とも書ける。
一般に第 $m$ 階前進差分を

$$
\begin{align*}
\varDelta^m f(x) & = \varDelta (\varDelta^{m-1} f(x)) \cr
& = \varDelta^{m-1} f(x + h) - \varDelta^{m-1} f(x) \tag{5.37} \cr
\end{align*}
$$

と定義すれば、
\varDelta mf(x_0) = m ! hmf[ x_0, x_1, x_2, \cdots , xm ] \tag{5.38}
であることがわかる。

なお、前進差分の他に **後退差分** (backward difference) や **中心差分** (centered dif-
ference) もある。

$$
\begin{alignat*}{3}
& \nabla f(x) & & \equiv f(x) - f(x - h) & \qquad & \text{後退差分} \tag{5.39} \cr
& \delta f(x) & & \equiv f \left( x + \frac{1}{2} h \right) - f \left( x - \frac{1}{2} h \right) & \qquad & \text{中心差分} \tag{5.40} \cr
\end{alignat*}
$$

後退差分は、第6章常微分方程式の数値解法のとき、とくに重要になる。
このとき、 $(5.38)$ に対応する関係式は

$$
\begin{align*}
\nabla^m f(x) & = \nabla (\nabla^{m-1} f(x)) \cr
& = \nabla^{m-1} f(x) - \nabla^{m-1} f(x - h) \tag{5.41} \cr
\end{align*}
$$

と $m$ 階後退差分を定義すれば、

$$
\nabla^m f(x_m) = m!\ h^m f[x_0, x_1, x_2, \cdots , x_m] \tag{5.42}
$$

である。

### 5.2.4 差分商の拡張

差分商は、 $(5.32)$ から $(5.35)$ のように、変数 $x_0, x_1, \cdots, x_n$ に等しいものがあれば、分子も分母も $0$ となり不定形になるように見える。
しかし、[例 5.1] の場合に見られるように、差分商は対称式であり、変数を等しくしてみると、 $f[x, x] = f^\prime (x)$ 、 $f[x, x, x] = f^{\prime\prime}(x) / 2!$ が成り立っている。
以下、

$$
f[\underbrace{x, x, \cdots , x, x, x}_ {k+1 \text{個}}] = \frac{f^{(k)} (x)}{k!} \tag{5.43}
$$

が任意の $k$ に対して成立することを証明する。
いま、ある $k$ にたいして成立しているとする。
$k + 1$ に対して $(5.43)$ は

$$
\begin{align*}
f[\underbrace{x, x, \cdots , x, x, x}_ {k+2 \text{個}} ] & = \lim_{h \to 0} \frac{1}{k + 1} \sum_{i=1}^{k+1} f[\underbrace{x + h, \cdots , x + h}_ {k+2-i 個} , \underbrace{x, \cdots , x}_ {i 個} ] \cr
& = \frac{1}{k + 1} \lim_{h \to 0} \sum_{i=1}^{k+1} \frac{1}{h} \left[ f[ \underbrace{x + h, \cdots, x + h}_ {k+2-i \text{個}}, \underbrace{x, \cdots, x}_ {i-1 \text{個}} ] - f[ \underbrace{x + h, \cdots, x + h}_ {k+1-i \text{個}}, \underbrace{x, \cdots , x}_ {i 個} ] \right] \cr
& = \frac{1}{k + 1}  \lim_{h \to 0} \frac{1}{h} [ f[ \underbrace{x + h, \cdots, x + h}_ {k+1 \text{個}} ] - f[ \underbrace{x, \cdots, x}_ {k+1 \text{個}} ] ] \cr
& = \frac{1}{(k + 1)!} \lim_{h \to 0} \frac{f^{(k)} (x + h) - f^{(k)}(x)}{h} \cr
& = \frac{f^{(k+1)}(x)}{(k + 1)!} \tag{5.44} \cr
\end{align*}
$$

である。
故に、数学的帰納法より $(5.43)$ は任意の $k$ に対して成立する。

一般に、 $D = d / dx$ と置くと、

$$
f[x_0, x_1, x_2, \cdots , x_n, \underbrace{x, x, \cdots , x}_ {k+1 個} ] = \frac{1}{k!} D^k f[x_0, x_1, x_2, \cdots , x_n, x] \tag{5.45}
$$

が任意の $x$ の (微分可能な) 関数 $f(x)$ に対して成立することが、 $(5.43)$ と同様に証明できる。
その証明のためには、 $(5.43)$ の $f(x)$ を $f[x_0, x_1, x_2, \cdots , x_n, x]$ で置き換えるだけでよい。
$(5.45)$ はさらに $x_0, x_1, \cdots x_n$ のそれぞれが複数個存在する場合に拡張できることは明らかであろう (エルミ－トの補間公式 $(5.60)$ 参照)。

また、差分商をいくつかの変数が等しい場合でも成立するように

$$
\begin{align*}
f & [x_n, x_{n-1}, \cdots , x_1, x_0] \cr
& = \int_0^1 \int_0^{t_1} \cdots \int_0^{t_{n-1}} f^{(n)} \left( x_0 + \sum_{k=1}^{n} t_k (x_k - x_{k-1}) \right) dt_n \cdots dt_2 dt_1 \tag{5.46} \cr
\end{align*}
$$

と定義することができる (問題 5-3 参照)。

### 5.2.5 ニュ－ト ンの補間公式

以上の差分商を用いれば、 $p_n (x)$ は次のように表される。

$$
\boxed{
\begin{align*}
\quad \cr
& \text{ニュ－トンの補間公式} \cr
& \quad \begin{alignat*}{5}
p_n (x) & = & & f[x_0] + (x - x_0) f[x_0, x_1] + \cdots \cr
& & & + (x - x_0)(x - x_1) \cdots (x - x_{n-1})f[x_0, x_1, \cdots , x_n] \cr
& = & & p_{n-1} (x) + \phi_n (x) f[x_0, x_1, \cdots , x_{n-1}, x_n] \tag{5.47} \cr
\end{alignat*} \cr
\end{align*} \quad
}
$$

これを **ニュ－トンの補間公式** という。
この公式は、ある $x$ に対する $p_n (x)$ を $f(x_i)$ $(0 \leqq i \leqq n)$ から数値的に求めるのによく使われる。
特に等間隔分点のときは、差分商を $(5.38)$ から前進差分で表して

$$
\begin{align*}
p_n (x) = &\ f(x_0) + \frac{x - x_0}{h} \varDelta f(x_0) + \cdots \cr
& + \frac{(x - x_0)(x - x_1) \cdots (x - x_{n-1})}{n!\ h^n} \varDelta ^n f(x_0) \tag{5.48} \cr
\end{align*}
$$

である。
次の 例題 5.3 で公式 $(5.47)$ の証明をしよう。

***

#### 例題 5.3

ニュ－トンの補間公式 $(5.47)$ を証明せよ。

#### ［解］{#solve5.3}

この第1式を証明するために、 $n$ 次多項式 $p_n (x)$ を

$$
\begin{align*}
p_n (x) = c_0 & + c_1(x - x_0) + c_2(x - x_0)(x - x_1) + \cdots \cr
& + c_n(x - x_0)(x - x_1) \cdots (x - x_{n-1}) \tag{5.49} \cr
\end{align*}
$$

と表し、 $p_n (x_i) = f(x_i) \ (0 \leqq i \leqq n)$ となるように $c_i$ を定めよう。
まず、 $x = x_0$ と置けば、 $c_0 = f(x_0) = f[x_0] が得られる。
これを $(5.49)$ に代入し 変形して

$$
\begin{align*}
\frac{p_n (x) - f[x_0]}{x - x_0} = c_1 & + c_2(x - x_1) + \cdots \cr
& + c_n (x - x_1) \cdots (x - x_{n-1}) \tag{5.50} \cr
\end{align*}
$$

が得られる。
この式で $x = x_1$ と置くと、 $c_1 = f[x_1, x_0]$ が得られる。
$c_1$ を $(5.50)$ に代入して、

$$
\begin{align*}
& \frac{p_n (x) - f[x_0] - (x - x_0) f[x_1, x_0]}{(x - x_0)(x - x_1)} \cr
& \qquad = c_2 + c_3 (x - x_2) + \cdots + c_n (x - x_2) \cdots (x - x_{n-1}) \tag{5.51} \cr
\end{align*}
$$

である。
この式で $x = x_2$ と置くと、右辺は $c_2$ 、左辺は $f[x_2, x_1, x_0]$ であるから、 $c_2 = f[x_2, x_1, x_0]$ が得られる。
同様の繰り返しによって、 $(5.47)$ の第1式の証明が完結する。
第1式の最後の項を除いたものが $p_{n-1} (x)$ であるから、第2式が得られる。

なお、 $p_0 (x) = f[x_0] = f(x_0)$ は $x = x_0$ で $f(x)$ と一致する0次式であり、 $p_1 (x) = f(x_0) + (x - x_0) f[x_0, x_1]$ は $x = x_0$ と $x = x_1$ で $f(x)$ と一致する1次式、 $\cdots$ と順に確かめて行くことによっても、 $(5.47)$ は確かめられる。
( もう一つのラグランジュの補間式の形 **ネビユの補間公式** については 問題 5-4 を参照。)

***

#### ［例 5.2］

等間隔4分点における $f(x)$ の値が次のようにわかっているとき、これらの点を通る3次多項式を求めよう。

$$
\begin{array}{rrrrr}
x & 0 & 1 & 2 & 3 \cr
f(x) & -5 & 0 & 6 & 20 \cr
\end{array}
$$

次のような階差表をつくり、 $\varDelta^m f(0)$ を求め、 $(5.48)$ に代入する。

$$
\begin{array}{c|cccc}
x & f(x) & \varDelta f(x) & \varDelta^2 f(x) & \varDelta^3 f(x) \cr \hline
0 & \underline{-5} & \underline{5} & \underline{1} & \underline{7} \cr
1 & 0 & 6 & 8 \cr
2 & 6 & 14 \cr
3 & 20 \cr
\end{array}
$$

この表より、 $f(0) = -5$ 、 $\varDelta f(0) = 5$ 、 $\varDelta^2 f(0) = 1$ 、 $\varDelta^3 f(0) = 7$ 。
そして、 $h = 1$ で等間隔だから、前進差分 $(5.38)$ とニュートンの補間公式 $(5.47)$ より

$$
\begin{aligned}
p_0(x) & = -5, \frac{}{} \cr
p_1(x) & = p_0(x) + (x - 0) \varDelta f (0) = 5x - 5, \frac{}{} \cr
p_2(x) & = p_1(x) + \frac{(x - 0)(x - 1)}{2} \varDelta^2 f(0) \cr
& = \frac{1}{2} x^2 + \frac{9}{2} x - 5 \cr
p_3(x) & = p_2(x) + \frac{(x - 0)(x - 1)(x - 2)}{6} \varDelta^3 f(0) \cr
& = \frac{7}{6} x^3 - 3x^2 + \frac{41}{6} x - 5 \cr
\end{aligned}
$$

なお、ニュ－トンの補間公式を用いた数値補間の例を第8章図 8.1 に示す。
図 8.1 の例は、補間領域が広すぎて、ルンゲの現象が起こる例である。
